<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.6.8. Lockbox &#8212; pyrpl 0.9.7.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=4468db6d" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <script src="../../_static/documentation_options.js?v=cf93a8f2"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../_static/icon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.6.9. DataWidget" href="data_widget.html" />
    <link rel="prev" title="5.6.7. AcquisitionModule" href="acquisition_module.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>
  

  <style id="ribbon">
    #forkongithub a{background:#c11;color:#fff;text-decoration:none;font-family:arial,sans-serif;text-align:center;font-weight:bold;padding:5px 40px;font-size:1rem;line-height:2rem;position:relative;transition:0.5s;}
    #forkongithub a:hover{background:#1c1;color:#fff;}
    #forkongithub a::before,
    #forkongithub a::after{content:"";width:100%;display:block;position:absolute;top:1px;left:0;height:1px;background:#fff;}
    #forkongithub a::after{bottom:1px;top:auto;}@media screen and (min-width:800px)
    { #forkongithub{position:fixed;display:block;top:0;right:0;width:200px;overflow:hidden;height:200px;z-index:9999;}#forkongithub a{width:200px;position:absolute;top:45px;right:-45px;transform:rotate(45deg);-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);box-shadow:4px 4px 10px rgba(0,0,0,0.8);}}
  </style>
  <span id="forkongithub"><a href="https://www.github.com/lneuhaus/pyrpl#fork-destination-box">Fork PyRPL on GitHub</a></span>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-102689373-2', 'auto');
    ga('send', 'pageview');

  </script>


  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          PyRPL</a>
        <span class="navbar-text navbar-version pull-left"><b>0.9.7.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../index.html">Home</a></li>
                <li><a href="../../installation.html">Installation</a></li>
                <li><a href="../../gui.html">Graphical user interface</a></li>
                <li><a href="../../api.html">API</a></li>
                <li><a href="../../basics.html">How PyRPL works</a></li>
                <li><a href="../index.html">Infos for Developers</a></li>
            
            
              
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">5.6.8. Lockbox</a></li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <section id="lockbox">
<h1><span class="section-number">5.6.8. </span>Lockbox<a class="headerlink" href="#lockbox" title="Link to this heading">¶</a></h1>
<p>Lockbox is the base class for all customizations of lockbox behavior.
Any customized lockbox is implemented by defining a class that inherits
from Lockbox. This allows to add custom functionality to preexisting
lockbox types and furthermore to easily overwrite the default functions
of the lockbox API with custom behaviour.</p>
<p>The general way to implement a custom lockbox class is to copy the file
“pyrpl/software_modules/lockbox/models/custom_lockbox_example.py”
into the folder
“<cite>:math:`PYRPL_USER_DIR</cite> &lt;<a class="reference external" href="https://github.com/lneuhaus/pyrpl/wiki/Installation:-Directory-for-user-data-%22PYRPL_USER_DIR%22">https://github.com/lneuhaus/pyrpl/wiki/Installation:-Directory-for-user-data-%22PYRPL_USER_DIR%22</a>&gt;`__/lockbox”
and to start modifying it. PyRPL will automatically search this
directory for classes that have Lockbox as one base class and allow to
select these by setting the corresponding class name in the property
‘classname’ of a Lockbox instance.</p>
<p>Each time the Lockbox type is changed in this way, (can happen through
the API, the GUI or the configfile, i.e.
<code class="docutils literal notranslate"><span class="pre">pyrpl.lockbox.classname</span> <span class="pre">=</span> <span class="pre">'FabryPerot'</span></code>), a new Lockbox object is
created from the corresponding derived class of Lockbox. This ensures
that the Lockbox and all its signals are properly initialized.</p>
<p>To keep the API user-friendly, two things should be done - since Lockbox
inherits from SoftwareModule, we must keep the namespace in this object
minimum. That means, we should make a maximum of properties and methods
hidden with the underscore-trick.</p>
<ul class="simple">
<li><p>the derived Lockbox object should define a shortcut class object ‘sc’
that contains the most often used functions.</p></li>
</ul>
<p>The default properties of Lockbox are</p>
<ul class="simple">
<li><p>inputs: list or dict of inputs —&gt; a list is preferable if we want
the input name to be changeable, otherwise the “name” property
becomes redundant with the dict key. But maybe we actually want the
signal names to be defined in the Lockbox class itself?</p></li>
<li><p>outputs: list or dict of outputs —&gt; same choice to make</p></li>
<li><p>function lock(setpoint, factor=1) —&gt; Needs to be well documented:
for instance, I guess setpoint only applies to last stage and factor
to all stages ? —&gt; Also, regarding the discussion about the return
value of the function, I think you are right that a promise is
exactly what we need. It can be a 5 line class with a blocking get()
method and a non-blocking ready() method. We should use the same
class for the method run.single() of acquisition instruments.</p></li>
<li><p>function unlock()</p></li>
<li><p>function sweep()</p></li>
<li><p>function calibrate() –&gt; I guess this is a blocking function ?</p></li>
<li><p>property islocked</p></li>
<li><p>property state</p></li>
</ul>
<p>—&gt; Sequence (Stages) are missing in this list. I would advocate for
keeping a “sequence” container for stages since it can be desirable to
only manipulate the state of this submodule (especially with the new
YmlEditor, editing the sequence alone becomes a very natural thing to
do). I agree that the current implementation where all the sequence
management functions are actually delegated to Lockbox is garbage.</p>
<p>—&gt; Now that we are at the point where one only needs to derive Lockbox
(which I believe makes sense), we could also simplify our lives by
making both the list of inputs and outputs fixe sized: they would both
be specified by a list-of-class in the LockboxClass definition. If the
names are also static, then it would probably be a list of tuples (name,
SignalClass) or an OrderedDict(name, SignalClass). I guess adding a
physical output is rare enough that it justifies writing a new class?</p>
<p>PS: regarding the specification of the pairs (name, signal) in the
Lockbox class. I just realized that if we want the lists to be
fixe-sized, the cleanest solution is to use a descriptor per input (same
for outputs). This is exactly what they are made for…</p>
<p>&#64;Samuel: What is the advantage of your solution to saving inputs and
outputs as (Ordered)Dicts?</p>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/developer_guide/api/lockbox.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2014-2025, Leonhard Neuhaus, Samuel Deléglise, Michaël Croquette .<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.4.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>